{
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "Hunting - SigninLogs Threat Hunting",
      "metadata": {
        "description": "The friendly name for the workbook that is used in the Gallery or Saved List.  This name must be unique within a resource group."
      }
    },
    "workbookType": {
      "type": "string",
      "defaultValue": "sentinel",
      "metadata": {
        "description": "The gallery that the workbook will been shown under. Supported values include workbook, tsg, etc. Usually, this is 'workbook'"
      }
    },
    "workbookSourceId": {
      "type": "string",
      "defaultValue": "/subscriptions/ffd3e92d-f8fe-4d9d-b2cf-26d39ab4dce3/resourcegroups/rg1/providers/microsoft.operationalinsights/workspaces/ws-test",
      "metadata": {
        "description": "The id of resource instance to which the workbook will be associated"
      }
    },
    "workbookId": {
      "type": "string",
      "defaultValue": "[newGuid()]",
      "metadata": {
        "description": "The unique guid for this workbook instance"
      }
    }
  },
  "resources": [
    {
      "name": "[parameters('workbookId')]",
      "type": "microsoft.insights/workbooks",
      "location": "[resourceGroup().location]",
      "apiVersion": "2022-04-01",
      "dependsOn": [],
      "kind": "shared",
      "properties": {
        "displayName": "[parameters('workbookDisplayName')]",
        "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"27c044d8-9f66-41a6-8765-2ad2b1f94cc5\",\"type\":4,\"name\":\"TimeRange\",\"label\":\"Time Range\",\"description\":\"Select the time range for analysis\",\"defaultValue\":\"P1D\",\"isRequired\":true,\"validations\":[{\"type\":7,\"criteria\":\"value != null && value != ''\"}],\"value\":{},\"typeSettings\":{\"selectableValues\":[{\"value\":\"PT1H\",\"label\":\"Last 1 hour\"},{\"value\":\"PT6H\",\"label\":\"Last 6 hours\"},{\"value\":\"PT12H\",\"label\":\"Last 12 hours\"},{\"value\":\"P1D\",\"label\":\"Last 24 hours\"},{\"value\":\"P2D\",\"label\":\"Last 48 hours\"},{\"value\":\"P7D\",\"label\":\"Last 7 days\"},{\"value\":\"P30D\",\"label\":\"Last 30 days\"}],\"allowCustom\":true}},{\"id\":\"9c0e1e2c-6f7b-4a8d-b3e2-5f6a9b8c7d0e\",\"type\":1,\"name\":\"InvestigateUser\",\"label\":\"Investigate User (UPN)\",\"description\":\"Enter User Principal Name for deep dive investigation\",\"defaultValue\":\"\",\"typeSettings\":{\"placeholder\":\"user@company.com\"}},{\"id\":\"a1b2c3d4-5e6f-7g8h-9i0j-k1l2m3n4o5p6\",\"type\":1,\"name\":\"InvestigateIP\",\"label\":\"Investigate IP Address\",\"description\":\"Enter IP address for investigation\",\"defaultValue\":\"\",\"typeSettings\":{\"placeholder\":\"192.168.1.1\"}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"f6b5a4c3-d2e1-f0a9-b8c7-d6e5f4a3b2c1\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"üìä Overview\",\"subTarget\":\"Overview\",\"style\":\"primary\"},{\"id\":\"a2b3c4d5-e6f7-g8h9-i0j1-k2l3m4n5o6p7\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"üî¥ Brute Force\",\"subTarget\":\"BruteForce\",\"style\":\"primary\"},{\"id\":\"b3c4d5e6-f7g8-h9i0-j1k2-l3m4n5o6p7q8\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"üü† Password Spray\",\"subTarget\":\"PasswordSpray\",\"style\":\"primary\"},{\"id\":\"c4d5e6f7-g8h9-i0j1-k2l3-m4n5o6p7q8r9\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"üåç Geolocation\",\"subTarget\":\"Geolocation\",\"style\":\"primary\"},{\"id\":\"d5e6f7g8-h9i0-j1k2-l3m4-n5o6p7q8r9s0\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"üîç Anomalies\",\"subTarget\":\"Anomalies\",\"style\":\"primary\"},{\"id\":\"e6f7g8h9-i0j1-k2l3-m4n5-o6p7q8r9s0t1\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"‚ö†Ô∏è Risk Analysis\",\"subTarget\":\"RiskAnalysis\",\"style\":\"primary\"},{\"id\":\"f7g8h9i0-j1k2-l3m4-n5o6-p7q8r9s0t1u2\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"üîê MFA Analysis\",\"subTarget\":\"MFAAnalysis\",\"style\":\"primary\"}]},\"name\":\"tabs\"},{\"type\":1,\"content\":{\"json\":\"## üéØ SigninLogs Threat Hunting Workbook\\n\\nYour frontline defense against identity-based attacks in Microsoft Sentinel\\n\\nThis workbook includes seven powerful tabs for comprehensive identity threat hunting:\\n\\nüìä **Overview**: High-level sign-in metrics, failure trends, and country distribution  \\nüî¥ **Brute Force**: Identify users under attack and attackers succeeding after multiple failures  \\nüü† **Password Spray**: Detect IPs targeting multiple users in short timeframes  \\nüåç **Geolocation**: Spot impossible travel and sign-ins from high-risk countries  \\nüîç **Anomalies**: Surface off-hours activity, legacy protocols, new devices, and suspicious user agents  \\n‚ö†Ô∏è **Risk Analysis**: Correlate sign-in behavior with Identity Protection risk events and Conditional Access blocks  \\nüîê **MFA Analysis**: Audit MFA usage, identify gaps, and track enforcement across apps\\n\\n**Time Range**: {TimeRange}\\n**Investigate User**: {InvestigateUser}\\n**Investigate IP**: {InvestigateIP}\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Overview\"},\"name\":\"overview-header\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SigninLogs\\n| where TimeGenerated >= ago({TimeRange})\\n| summarize TotalSignins = count(), FailedSignins = countif(ResultType != 0), SuccessSignins = countif(ResultType == 0)\\n| extend SuccessRate = round((SuccessSignins * 100.0) / TotalSignins, 2), FailureRate = round((FailedSignins * 100.0) / TotalSignins, 2)\\n| project TotalSignins, SuccessSignins, FailedSignins, SuccessRate, FailureRate\",\"size\":1,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"formatter\":1,\"format\":\"Big Number\",\"showIcon\":true},\"leftContent\":{\"columnMatch\":\"TotalSignins\",\"formatter\":12,\"format\":\"Big Number\",\"palette\":\"auto\"},\"secondaryContent\":{\"columnMatch\":\"SuccessRate\",\"formatter\":12,\"format\":\"Big Number\"}}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Overview\"},\"name\":\"total-signins-tile\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SigninLogs\\n| where TimeGenerated >= ago({TimeRange}) and ResultType != 0\\n| summarize Count = count() by ResultDescription\\n| top 10 by Count desc\\n| extend ResultDescription = iif(isempty(ResultDescription), 'Other', ResultDescription)\\n| render piechart\",\"size\":3,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"title\":\"Top Failure Reasons\"}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Overview\"},\"name\":\"failure-reasons-chart\"},{\"type\":1,\"content\":{\"json\":\"## üî¥ Brute Force Detection\\n\\nIdentify users under credential stuffing and brute-force attacks:\\n\\n**Detection Criteria**:\\n- Users with >10 failed sign-ins within 1 hour\\n- Successful sign-ins after multiple failures (possible compromise)\\n- IP addresses targeting multiple users\\n\\n*MITRE ATT&CK: T1110.001 - Password Guessing*\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"BruteForce\"},\"name\":\"brute-force-header\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let timeframe = 1h;\\nSigninLogs\\n| where TimeGenerated >= ago({TimeRange}) and ResultType != 0\\n| make-series FailedCount = count() default=0 on TimeGenerated from ago({TimeRange}) to now() step timeframe by UserPrincipalName\\n| where array_sum(FailedCount) >= 10\\n| project UserPrincipalName, TotalFailures = array_sum(FailedCount)\\n| order by TotalFailures desc\\n| take 20\",\"size\":0,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UserPrincipalName\",\"formatter\":5,\"format\":{\"linkTarget\":\"CellDetails\"}}]}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"BruteForce\"},\"name\":\"high-failure-users\"},{\"type\":1,\"content\":{\"json\":\"## üü† Password Spray Detection\\n\\nDetect stealthy password spray attacks targeting multiple users:\\n\\n**Detection Criteria**:\\n- Single IP attempting to sign in to >5 different users within 15 minutes\\n- Same user agent across multiple attempts\\n- Failed attempts with similar timing patterns\\n\\n*MITRE ATT&CK: T1110.003 - Password Spraying*\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"PasswordSpray\"},\"name\":\"password-spray-header\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let window = 15m;\\nSigninLogs\\n| where TimeGenerated >= ago({TimeRange}) and ResultType != 0\\n| summarize\\n    UserCount = dcount(UserPrincipalName),\\n    Attempts = count(),\\n    UserList = make_list(UserPrincipalName),\\n    FailureReasons = make_set(ResultDescription),\\n    UserAgents = make_set(UserAgent)\\n    by bin(TimeGenerated, window), IPAddress\\n| where UserCount >= 5\\n| order by UserCount desc\\n| project TimeGenerated, IPAddress, UserCount, Attempts, FailureReasons, UserAgents\",\"size\":0,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IPAddress\",\"formatter\":5,\"format\":{\"linkTarget\":\"CellDetails\"}}]}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"PasswordSpray\"},\"name\":\"password-spray-detection\"},{\"type\":1,\"content\":{\"json\":\"## üåç Geolocation Analysis\\n\\nDetect impossible travel and suspicious geographic patterns:\\n\\n**Detection Criteria**:\\n- Impossible travel (>800 km/h between consecutive sign-ins)\\n- Sign-ins from high-risk countries\\n- Multi-country sign-ins within short timeframes\\n- VPN/proxy usage patterns\\n\\n*MITRE ATT&CK: T1078 - Valid Accounts*\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Geolocation\"},\"name\":\"geolocation-header\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let highRiskCountries = dynamic(['North Korea', 'Iran', 'Russia', 'China', 'Syria']);\\nSigninLogs\\n| where TimeGenerated >= ago({TimeRange}) and ResultType == 0\\n| where LocationDetails.countryOrRegion in~ (highRiskCountries)\\n| summarize\\n    SigninCount = count(),\\n    Users = dcount(UserPrincipalName),\\n    UserList = make_list(UserPrincipalName),\\n    LatestSignin = max(TimeGenerated)\\n    by LocationDetails.countryOrRegion\\n| order by SigninCount desc\",\"size\":0,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UserList\",\"formatter\":5,\"format\":{\"linkTarget\":\"CellDetails\"}}]}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Geolocation\"},\"name\":\"high-risk-countries\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SigninLogs\\n| where TimeGenerated >= ago({TimeRange}) and ResultType == 0\\n| extend Country = LocationDetails.countryOrRegion\\n| summarize SigninCount = count() by Country\\n| where isnotempty(Country)\\n| top 10 by SigninCount desc\\n| render columnchart\",\"size\":3,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"columnchart\",\"chartSettings\":{\"title\":\"Top Sign-in Countries\"}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Geolocation\"},\"name\":\"country-distribution\"},{\"type\":1,\"content\":{\"json\":\"## üîç Anomaly Detection\\n\\nSurface suspicious activities and deviations from normal patterns:\\n\\n**Detection Categories**:\\n- Off-hours sign-ins (outside business hours)\\n- Legacy protocol usage (IMAP, POP, SMTP)\\n- New devices and user agents\\n- Suspicious user agents (curl, python, scripts)\\n- Device and location anomalies\\n\\n*MITRE ATT&CK: T1078.004 - Cloud Accounts*\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Anomalies\"},\"name\":\"anomalies-header\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let businessStart = 8;\\nlet businessEnd = 18;\\nSigninLogs\\n| where TimeGenerated >= ago({TimeRange}) and ResultType == 0\\n| extend HourOfDay = hourofday(TimeGenerated)\\n| where HourOfDay < businessStart or HourOfDay > businessEnd\\n| summarize\\n    SigninCount = count(),\\n    Users = dcount(UserPrincipalName),\\n    RecentSignin = max(TimeGenerated),\\n    IPAddresses = make_set(IPAddress)\\n    by UserPrincipalName\\n| order by SigninCount desc\\n| take 20\",\"size\":0,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UserPrincipalName\",\"formatter\":5,\"format\":{\"linkTarget\":\"CellDetails\"}}]}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Anomalies\"},\"name\":\"off-hours-signins\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let suspiciousUserAgents = dynamic(['curl', 'python', 'requests', 'wget', 'powershell', 'invoke', 'postman', 'scan', 'bot', 'spider']);\\nSigninLogs\\n| where TimeGenerated >= ago({TimeRange})\\n| where UserAgent has_any (suspiciousUserAgents)\\n| summarize\\n    Count = count(),\\n    Users = dcount(UserPrincipalName),\\n    UserList = make_list(UserPrincipalName),\\n    IPList = make_set(IPAddress),\\n    Latest = max(TimeGenerated)\\n    by UserAgent\\n| order by Count desc\\n| take 15\",\"size\":0,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UserList\",\"formatter\":5,\"format\":{\"linkTarget\":\"CellDetails\"}}]}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Anomalies\"},\"name\":\"suspicious-user-agents\"},{\"type\":1,\"content\":{\"json\":\"## ‚ö†Ô∏è Risk Analysis\\n\\nCorrelate sign-in behavior with Microsoft Identity Protection risk signals:\\n\\n**Integration Points**:\\n- Azure AD Identity Protection risky sign-ins\\n- Conditional Access policy blocks\\n- User risk levels and remediation status\\n- Risk-based conditional access policies\\n\\n*MITRE ATT&CK: TA0001 - Initial Access*\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"RiskAnalysis\"},\"name\":\"risk-analysis-header\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SigninLogs\\n| where TimeGenerated >= ago({TimeRange})\\n| where ConditionalAccessStatus == 'failure' or ConditionalAccessStatus == 'reportOnlyFailure'\\n| summarize\\n    BlockCount = count(),\\n    Users = dcount(UserPrincipalName),\\n    UserList = make_list(UserPrincipalName),\\n    Policies = make_set(ConditionalAccessPolicies),\\n    LatestBlock = max(TimeGenerated)\\n    by ConditionalAccessStatus\\n| order by BlockCount desc\",\"size\":0,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UserList\",\"formatter\":5,\"format\":{\"linkTarget\":\"CellDetails\"}}]}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"RiskAnalysis\"},\"name\":\"conditional-access-blocks\"},{\"type\":1,\"content\":{\"json\":\"## üîê MFA Analysis\\n\\nAudit Multi-Factor Authentication usage and identify security gaps:\\n\\n**Analysis Areas**:\\n- Users without MFA enrollment\\n- MFA methods distribution (SMS, Authenticator, FIDO2)\\n- Applications without MFA enforcement\\n- MFA bypass attempts and failures\\n- Conditional Access policy coverage\\n\\n*MITRE ATT&CK: T1110 - Brute Force*\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"MFAAnalysis\"},\"name\":\"mfa-analysis-header\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SigninLogs\\n| where TimeGenerated >= ago({TimeRange}) and ResultType == 0\\n| extend MFAMethod = iif(isnotempty(AuthenticationDetails) and AuthenticationDetails has 'phoneAppNotification', 'Authenticator',\\n                         iif(AuthenticationDetails has 'phoneAppOTP', 'Authenticator OTP',\\n                         iif(AuthenticationDetails has 'sms', 'SMS',\\n                         iif(AuthenticationDetails has 'fido2', 'FIDO2',\\n                         iif(AuthenticationDetails has 'windowsHelloForBusiness', 'Windows Hello',\\n                         iif(AuthenticationDetails != '', 'Other', 'None'))))))\\n| summarize Count = count() by MFAMethod\\n| order by Count desc\\n| render piechart\",\"size\":3,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"title\":\"MFA Methods Distribution\"}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"MFAAnalysis\"},\"name\":\"mfa-methods-distribution\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SigninLogs\\n| where TimeGenerated >= ago({TimeRange}) and ResultType == 0\\n| where AuthenticationRequirement == 'singleFactorAuthentication'\\n| summarize\\n    SigninCount = count(),\\n    Apps = dcount(AppDisplayName),\\n    AppList = make_list(AppDisplayName),\\n    Locations = make_set(LocationDetails.countryOrRegion),\\n    RecentSignin = max(TimeGenerated)\\n    by UserPrincipalName\\n| order by SigninCount desc\\n| take 20\",\"size\":0,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UserPrincipalName\",\"formatter\":5,\"format\":{\"linkTarget\":\"CellDetails\"}}]}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"MFAAnalysis\"},\"name\":\"single-factor-users\"},{\"type\":1,\"content\":{\"json\":\"## üîé User Investigation\\n\\nDeep-dive investigation for specific user:\\n\\n**User**: {InvestigateUser}\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Overview\"},\"name\":\"text - 20\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SigninLogs\\n| where TimeGenerated >= ago({TimeRange}) and UserPrincipalName == '{InvestigateUser}'\\n| summarize\\n    TotalSignins = count(),\\n    Successful = countif(ResultType == 0),\\n    Failed = countif(ResultType != 0),\\n    SuccessRate = round((countif(ResultType == 0) * 100.0) / count(), 2),\\n    Countries = dcount(LocationDetails.countryOrRegion),\\n    IPs = dcount(IPAddress),\\n    Apps = dcount(AppDisplayName),\\n    LatestSignin = max(TimeGenerated)\\n    by UserPrincipalName\",\"size\":1,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"formatter\":1,\"format\":\"Big Number\",\"showIcon\":true}}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Overview\"},\"name\":\"query - 21\"},{\"type\":1,\"content\":{\"json\":\"## üåê IP Address Investigation\\n\\nDeep-dive investigation for specific IP address:\\n\\n**IP**: {InvestigateIP}\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Overview\"},\"name\":\"text - 22\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SigninLogs\\n| where TimeGenerated >= ago({TimeRange}) and IPAddress == '{InvestigateIP}'\\n| summarize\\n    TotalAttempts = count(),\\n    Successful = countif(ResultType == 0),\\n    Failed = countif(ResultType != 0),\\n    Users = dcount(UserPrincipalName),\\n    UserList = make_list(UserPrincipalName),\\n    Countries = dcount(LocationDetails.countryOrRegion),\\n    Apps = dcount(AppDisplayName),\\n    FirstSeen = min(TimeGenerated),\\n    LastSeen = max(TimeGenerated)\\n    by IPAddress\",\"size\":1,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"formatter\":1,\"format\":\"Big Number\",\"showIcon\":true}}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Overview\"},\"name\":\"query - 23\"},{\"type\":1,\"content\":{\"json\":\"## üõ°Ô∏è Remediation Actions\\n\\n**Recommended Actions**:\\n\\n1. **For compromised users**:\\n   - Reset password immediately\\n   - Revoke existing sessions\\n   - Require MFA re-registration\\n   - Review sign-in logs for persistence\\n\\n2. **For malicious IPs**:\\n   - Add to Conditional Access block list\\n   - Create firewall rules\\n   - Report to threat intelligence feeds\\n\\n3. **For suspicious behavior**:\\n   - Enable Identity Protection policies\\n   - Configure risk-based conditional access\\n   - Implement user and entity behavior analytics (UEBA)\\n\\n4. **For MFA gaps**:\\n   - Enforce MFA for all users\\n   - Phase out SMS authentication\\n   - Implement FIDO2/Windows Hello\\n\\n**Automation**: Consider creating Azure Logic Apps or Sentinel Playbooks for automated response.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Overview\"},\"name\":\"text - 24\"},{\"type\":1,\"content\":{\"json\":\"## üßæ Conclusion\\n\\nThe **SigninLogs Threat Hunting Workbook** provides comprehensive visibility into identity-based threats in your Microsoft Sentinel environment. By leveraging this workbook, security teams can:\\n\\n‚úÖ **Detect** brute-force and password spray attacks in real-time  \\n‚úÖ **Investigate** impossible travel and suspicious geographic patterns  \\n‚úÖ **Identify** legacy protocol usage and MFA security gaps  \\n‚úÖ **Correlate** sign-in behavior with Identity Protection risk events  \\n‚úÖ **Automate** response actions through integrated playbooks  \\n‚úÖ **Comply** with regulatory requirements through comprehensive auditing\\n\\n**Deployment Notes**:\\n1. Ensure SigninLogs are properly ingested into Sentinel\\n2. Adjust time ranges and thresholds based on your environment\\n3. Integrate with Azure AD Identity Protection for enhanced risk scoring\\n4. Create custom alerts based on workbook findings\\n5. Schedule regular review cycles for proactive threat hunting\\n\\n---\\n*This workbook follows Microsoft security best practices and aligns with MITRE ATT&CK framework.*\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Overview\"},\"name\":\"text - 25\"}],\"isLocked\":false,\"fallbackResourceIds\":[\"/subscriptions/ffd3e92d-f8fe-4d9d-b2cf-26d39ab4dce3/resourcegroups/rg1/providers/microsoft.operationalinsights/workspaces/ws-test\"]}",
        "version": "1.0",
        "sourceId": "[parameters('workbookSourceId')]",
        "category": "[parameters('workbookType')]"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "value": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookId'))]"
    }
  },
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"
}